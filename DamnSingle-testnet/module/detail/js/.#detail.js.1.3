var kittyInit = function (pageData) {
    $("body").empty();
    headerInit(pageData);
    $("body").append(kitteDataText);

    kitty_datail(pageData);

    // 点击跳转至 销售或交配选择页面
    $(".kitty-owner-chose div:eq(" + 0 + ")").click(function(){
        sale_sireInit("");
    });

    $(".kitty-owner-chose div:eq(" + 1 + ")").click(function(){
        sale_sellInit("");
    });

    $(".kitty-owner").click(function(){
        myKittyInit(who_kitty);
    });

    $(".buy-button").click(function () {
        if (pageData.auction.type == "sire") {
            sireInit(sire);
        } else if (pageData.auction.type == "sale") {
            // buyInit();
        }

    });
};

/**
 * 信息填充
 * @param {*} data 
 */
var kitty_datail = function (data) {
    $('.kitty-message-name').html(data.name + " #" + data.id);
    $('.kitty-message-name-small').html(data.name + "&nbsp" + data.id);
    $('.kitty-message-gen').html("Gen" + "&nbsp" + data.generation);
    $('.kitty-data-img').css("backgroundImage", "url(" + data.image_url + ")");
    $('.kitty-bio-message').html(data.bio);
    $('.kittyPage-up-part').css("background-color", data.color);
    kitty_status(data);
    kitty_owner(data);
    left_time(data);
    motherMessage(data);
    fatherMessage(data);
    $('.zan-num').html(data.purrs.count);
    childrenMessage(data);
    cattributesMessage(data);
}
/**
 * kitty目前状态：出售、交配、休息
 * 
 * todo 是否怀孕待确认
 * @param {*} data 
 */
var kitty_status = function (data) {
    if (data.status.is_ready == true) {
        if (data.auction.type == "sire") {
            $('.kitty-status').show();
            $('.kitty-to-sale').show();
            $('.AuctionGraph-chart').show();
            $('.kitty-price-change').show();
            $('.kitty-status-icon').css("backgroundImage", "url(./module/detail/img/kitty.png)"); //交配照片
            $('.kitty-status-item').html("For sire");
            $('.kitty-now-price-name').text("Breed now price");
            $('.buy-button').html("Sign in to sire");
        } else if (data.auction.type == "sale") {
            $('.kitty-status').show();
            $('.kitty-to-sale').show();
            $('.AuctionGraph-chart').show();
            $('.kitty-price-change').show();
            $('.kitty-status-icon').css("backgroundImage", "url(./module/detail/img/kitty.png)"); //出售照片
            $('.kitty-status-item').html("For sale");
            $('.kitty-now-price-name').text("Buy now price");
            $('.buy-button').html("Sign in to buy");
        } else if (isNaN(data.auction.type)) {
            $('.kitty-status').hide();
            $('.kitty-message-cooldown').html(cooldown[data.status.cooldown_index] + "&nbsp" + "Cooldown");
            $('.kitty-to-sale').hide();
            $('.AuctionGraph-chart').hide();
            $('.kitty-price-change').hide();
            return;
        }
        $('.kitty-status-note').html((data.auction.current_price * 0.000000000000000001).toFixed(3));
        $('.kitty-now-price-num').text((data.auction.current_price * 0.000000000000000001).toFixed(3));
        $('.kitty-sale-start-price').html((data.auction.start_price * 0.000000000000000001).toFixed(3));
        $('.kitty-sale-end-price').html((data.auction.end_price * 0.000000000000000001).toFixed(3));
        $('.kitty-message-cooldown').html(cooldown[data.status.cooldown_index] + "&nbsp" + "Cooldown");
    }
}

/**
 * kitty主人信息
 */
var kitty_owner = function (data) {
    $('.kitty-ownwe-name').html(data.owner.nickname);
    $('.kitty-owner-img-effect').css("backgroundImage", "url(" + data.owner.image + ")");
}

/**
 * 剩余时间
 */
var left_time = function (data) {
    var nowDate = (new Date()).valueOf();
    var left_seconds = data.auction.end_time - nowDate;
    $('.sale-left-time').html(MillisecondToDate_text(left_seconds));
}

//毫秒转时分秒==汉字显示时间
function MillisecondToDate_text(msd) {
    var time = parseFloat(msd) / 1000;
    if (null != time && "" != time) {
        if (time > 60 && time < 60 * 60) { //分
            time = parseInt(time / 60.0) + "minute";
        } else if (time >= 60 * 60 && time < 60 * 60 * 24) { //时
            time = parseInt(time / 3600.0) + "hours";
        } else if (time >= 60 * 60 * 24 && time < 60 * 60 * 24 * 30) { //天
            time = parseInt(time / 86400.0) + "day";
        } else if (time >= 60 * 60 * 24 * 30 && time < 60 * 60 * 24 * 30 * 12) { //月
            time = parseInt(time / 2592000.0) + "month";
        } else if (time >= 60 * 60 * 24 * 30 * 12) { //年
            time = parseInt(time / 31104000.0) + "year";
        } else {
            time = parseInt(time) + "second";
        }
    } else {
        time = 0;
    }
    return time;
}

/**
 * 父母信息
 */
var motherMessage = function (data) {
    $('.kitty-parent-left').css("backgroundImage", "url(" + data.matron.image_url + ")");
    $('.kitty-parent-left').css("background-color", data.matron.color);
    $('.kitty-parent-left').click(function () {
        kittyInit(kitty_detail);
    });
}
var fatherMessage = function (data) {
    $('.kitty-parent-right').css("backgroundImage", "url(" + data.sire.image_url + ")");
    $('.kitty-parent-right').css("background-color", data.sire.color);
    $('.kitty-parent-right').click(function () {
        kittyInit(kitty_detail);
    });
}

/**
 * 孩子信息
 */
var childrenMessage = function (data) {
    for (var i = 0; i < data.children.length; i++) {
        var text = '<span id=children' + i + '></span>';
        $('.kitty-childrens').append(text);
        $('#children' + i).css("backgroundImage", "url(" + data.children[i].image_url + ")");
        $('#children' + i).css("background-color", data.children[i].color);
        $('#children' + i).click(function () {
            kittyInit(kitty_detail);
        });
    }
}

/**
 * cattribute信息
 */
var cattributesMessage = function (data) {
    for (var i = 0; i < data.cattributes.length; i++) {
        var text = '<div id=cattribute' + i + '>' +
            '<div id=cattribute-ione' + i + '></div>' +
            '<div id=cattribute-item' + i + '></div>' +
            '</div>';
        $('.kitty-tributes-message').append(text);
        $('#cattribute' + i).addClass("cattribute");
        $('#cattribute-item' + i).text(data.cattributes[i].description);
        $('#cattribute-ione' + i).addClass("cattribute-ione");
    }
}