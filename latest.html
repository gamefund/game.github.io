<!DOCTYPE html>
<html>
    <body style="width: 100%; height: 100%;">
        <div id="container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;">
            <div style="font-size: 30px">正在加载，请稍等。。。</div>
        </div>
        <script>
            /** ajax */
            function ajax(){
                var ajaxData = {
                    type:arguments[0].type || "POST",
                    url:arguments[0].url || "",
                    async:arguments[0].async || "true",
                    data:arguments[0].data || null,
                    dataType:arguments[0].dataType || "text",
                    contentType:arguments[0].contentType || "application/x-www-form-urlencoded",
                    beforeSend:arguments[0].beforeSend || function(){},
                    success:arguments[0].success || function(){},
                    error:arguments[0].error || function(){}
                }
                ajaxData.beforeSend()
                var xhr = createxmlHttpRequest();
                xhr.responseType=ajaxData.dataType;
                xhr.open(ajaxData.type,ajaxData.url,ajaxData.async);
                xhr.setRequestHeader("Content-Type",ajaxData.contentType);
                xhr.send(convertData(ajaxData.data));
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4) {
                        if(xhr.status == 200){
                            ajaxData.success(xhr.response)
                        }else{
                            ajaxData.error()
                        }
                    }
                }
            }

            function createxmlHttpRequest() {
                if (window.ActiveXObject) {
                    return new ActiveXObject("Microsoft.XMLHTTP");
                } else if (window.XMLHttpRequest) {
                    return new XMLHttpRequest();
                }
            }

            function convertData(data){
                if( typeof data === 'object' ){
                    var convertResult = "" ;
                    for(var c in data){
                        convertResult+= c + "=" + data[c] + "&";
                    }
                    convertResult=convertResult.substring(0,convertResult.length-1)
                    return convertResult;
                }else{
                    return data;
                }
            }

            

            /** 主函数 */
            (function() {
                //解析路径中传递过来的值
                var splitUrl = function(url, str){
                    var firstArr = url.split('?');
                    var secondArr = firstArr[firstArr.length - 1].split('&')
                    for(var i in secondArr){
                        if(secondArr[i].indexOf(str) != -1){
                            var resultArr = secondArr[i].split('=');
                            return resultArr[resultArr.length -1];
                        }
                    }
                }

                var ua =window.navigator.userAgent.toLowerCase();
                var isWeixin = ua.indexOf('micromessenger') !=-1;
                if (isWeixin){
                    window.location.href = "http://game.fund/index.html";
                }else {
                    function addLogDownloadSource() {
                        var generalServerIp=splitUrl(window.location.href,"generalServerIp") || "http://139.217.235.88:9001";
                        var userId =splitUrl(window.location.href,"userId");
                        var logUrl=generalServerIp+"/insertLogDownloadSource";
                        ajax({
                            async:false,
                            type:"post",
                            url: logUrl,
                            contentType:"application/json",
                            dateType:"json",
                            data:{userId:userId},
                            success:function (data) {
                            console.log("add log success")
                            }
                        })
                    }
                    addLogDownloadSource();
                    
                    window.location.href = "https://gf-1258943997.file.myqcloud.com/apk/GF1.0.13.apk";
                }
            })();
        </script>
    </body>
</html>
