<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <title>GF</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui">
    <style>
        *{
            font-size: 62.5%;
        }
        body{
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            margin: 0;
            padding: 0;
            font-family: "Arial", "Microsoft YaHei";
            overflow: hidden;
        }
        .wechatTip{
            margin-top: 20%;
            margin-bottom: 30%;
            text-align: center;
            font-size: 17px;
        }
        .buttonStyle{
            background-color: #Fb7299;
            border-radius: 4px;
            height: 40px;
            width: 75%;
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: #fff;
        }
        .text-tip{
            text-align: center;
            font-size: 20px;
            margin: 20px 0;
        } 
    </style>
</head>
<body>
<div id="container" style="">
    <div id="weChat-tip" class="wechatTip" style="visibility:hidden;">
        已安装？点击右上角用浏览器打开
    </div>
    <div style="text-align: center">
       <img id="log-img" src="https://game.fund/00.png" style="width:23%;text-align: center">
    </div>
    <div class="text-tip" >
        GF:发现好游戏
    </div>
    <div id="awakeUrl" class="buttonStyle" >进入App</div>
    <div id="enterApp" class="buttonStyle" >立即安装</div>

</div>
</body>

<script>
window.onload = function(){


/*        if (severIp!=null){
            document.getElementById('log-img').src=severIp + "/image/00.png";
        }*/
        // getLatestVersion();
        is_weixin();
        var url=window.location.href;
/*        if (url.indexOf("url") != -1) {
            var firstArr=url.split('?');
            var secondArr=firstArr[firstArr.length-1];
            var sURl=splitUrl(secondArr,"url");
            var decodeUrl=decodeURIComponent(sURl);
            window.location.href=decodeUrl;
        }else {*/
            //需要拼接的参数
            var decodeUrl=decodeURIComponent(url);
            var shareType=splitUrl(decodeUrl,"shareType");
            var componentId =splitUrl(decodeUrl,"componentId");
            var title =splitUrl(decodeUrl,"title");
            var contentTag =splitUrl(decodeUrl,"contentTag");
            var rootTag =splitUrl(decodeUrl,"rootTag");
            var pComponentId =splitUrl(decodeUrl,"pComponentId");
            var uerId =splitUrl(window.location.href,"uerId");

        document.getElementById('awakeUrl').onclick=function () {
            window.location.href="gf://data/123"+"?title=" + decodeURIComponent(title)+"&componentId="+componentId+"&contentTag="+contentTag + "&shareType="+shareType+"&rootTag="+rootTag+"&pComponentId="+pComponentId;
        }

        document.getElementById('enterApp').onclick=function () {
        var currentTime= new Date().getTime();
        if (uerId){
            addLogDownloadSource();
        }
        window.location.href="https://game.fund/latest.html?time="+currentTime;
        }
    }

    //解析路径中传递过来的值
    var splitUrl = function(url, str){
        var firstArr = url.split('?');
        var secondArr = firstArr[firstArr.length - 1].split('&')
        for(var i in secondArr){
            if(secondArr[i].indexOf(str) != -1){
                var resultArr = secondArr[i].split('=');
                return resultArr[resultArr.length -1];
            }
        }
    }
    function addLogDownloadSource() {
        var generalServerIp=splitUrl(window.location.href,"generalServerIp");
        var userId =splitUrl(window.location.href,"userId");
        var logUrl=generalServerIp+"/addLogRegisterInfo";
        ajax({
            async:false,
            type:"post",
            url: logUrl,
            contentType:"application/json",
            dateType:"json",
            data:{userId:userId},
            success:function (data) {
            console.log("add log success")
            }
        })
    }
/*    function getLatestVersion() {
        var postUrl=splitUrl(window.location.href,"updateUrl");
        // var uerId =splitUrl(window.location.href,"uerId");
        // var newUrl =postUrl.substr(7,postUrl.length-1);
        if (!postUrl){
            postUrl = "http://139.217.235.88:7080/container/queryLatestVersion"
        }
        ajax({
            async:false,
            type:"post",
            url: postUrl,
            contentType:"application/json",
            dateType:"json",
            success:function (data) {

            }
        })
    }*/


    function ajax(){
        var ajaxData = {
            type:arguments[0].type || "POST",
            url:arguments[0].url || "",
            async:arguments[0].async || "true",
            data:arguments[0].data || null,
            dataType:arguments[0].dataType || "text",
            contentType:arguments[0].contentType || "application/x-www-form-urlencoded",
            beforeSend:arguments[0].beforeSend || function(){},
            success:arguments[0].success || function(){},
            error:arguments[0].error || function(){}
        }
        ajaxData.beforeSend()
        var xhr = createxmlHttpRequest();
        xhr.responseType=ajaxData.dataType;
        xhr.open(ajaxData.type,ajaxData.url,ajaxData.async);
        xhr.setRequestHeader("Content-Type",ajaxData.contentType);
        xhr.send(convertData(ajaxData.data));
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                if(xhr.status == 200){
                    ajaxData.success(xhr.response)
                }else{
                    ajaxData.error()
                }
            }
        }
    }

    function createxmlHttpRequest() {
        if (window.ActiveXObject) {
            return new ActiveXObject("Microsoft.XMLHTTP");
        } else if (window.XMLHttpRequest) {
            return new XMLHttpRequest();
        }
    }

    function convertData(data){
        if( typeof data === 'object' ){
            var convertResult = "" ;
            for(var c in data){
                convertResult+= c + "=" + data[c] + "&";
            }
            convertResult=convertResult.substring(0,convertResult.length-1)
            return convertResult;
        }else{
            return data;
        }
    }

    function is_weixin() {
        var ua =window.navigator.userAgent.toLowerCase();
        var isWeixin = ua.indexOf('micromessenger') !=-1;
        if (isWeixin){
            var tip =document.getElementById('weChat-tip');
            tip.style.visibility='visible';
        }
    }

</script>
</html>