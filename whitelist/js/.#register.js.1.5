$(document).ready(function(){
//===================================================================
var account_rule = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
var psw_rule = /^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{7,35}$/;

$.cookie.json = true
var language = $.cookie("language");

if(language=="cn"){
    $("#rtitle_text1").html(cn.rtitle_text1);
    $("#rtitle_text2").html(cn.rtitle_text2);
    $("#rtitle_text3").html(cn.rtitle_text3);

    $("#rtitle_text4").html(cn.rtitle_text4);
    $("#detail-btn").html(cn.rtitle_text5);

    $("#register-btn").html(cn.register_btn);
    $("#to-login").html(cn.rto_login);
    $("#gsuccessful_title").html(cn.gsuccessful_title);
    $("#gsuccessfull_text1").html(cn.gsuccessfull_text1);
    $("#gsuccessfull_text2").html(cn.gsuccessfull_text2);
    $("#gactivation_successful_confirm").html(cn.gactivation_successful_confirm);

    $("#gtop_half_title").html(cn.gtop_half_title);//邀请码提示框内容===中文
    $("#gtop_half_text1").html(cn.gtop_half_text1);
    $("#gtop_half_text2").html(cn.gtop_half_text2);
    $("#gtop_half_text3").html(cn.gtop_half_text3);
    $("#gbottom_half_title").html(cn.gbottom_half_title);
    $("#bottom-half-text-ul-p1").html(cn.gbottom_half_text_ul_p1);
    $("#bottom-half-text-ul-p2").html(cn.gbottom_half_text_ul_p2);
}else if(language=="en"){
    $("*").attr("lang","en");
    $("#rtitle_text1").html(en.rtitle_text1);
    $("#rtitle_text2").html(en.rtitle_text2);
    $("#rtitle_text3").html(en.rtitle_text3);

    $("#rtitle_text4").html(en.rtitle_text4);
    $("#detail-btn").html(en.rtitle_text5);

    $("#register-btn").html(en.register_btn);
    $("#to-login").html(en.rto_login);
    $("#gsuccessful_title").html(en.gsuccessful_title);
    $("#gsuccessfull_text1").html(en.gsuccessfull_text1);
    $("#gsuccessfull_text2").html(en.gsuccessfull_text2);
    $("#gactivation_successful_confirm").html(en.gactivation_successful_confirm);
 
    $("#gtop_half_title").html(en.gtop_half_title);//邀请码提示框内容===英文
    $("#gtop_half_text1").html(en.gtop_half_text1);
    $("#gtop_half_text2").html(en.gtop_half_text2);
    $("#gtop_half_text3").html(en.gtop_half_text3);
    $("#gbottom_half_title").html(en.gbottom_half_title);
    $("#bottom-half-text-ul-p1").html(en.gbottom_half_text_ul_p1);
    $("#bottom-half-text-ul-p2").html(en.gbottom_half_text_ul_p2);
}else if(language=="ja"){
    $("*").attr("lang","jpn");
    $("#rtitle_text1").html(ja.rtitle_text1);
    $("#rtitle_text2").html(ja.rtitle_text2);
    $("#rtitle_text3").html(ja.rtitle_text3);

    $("#rtitle_text4").html(ja.rtitle_text4);
    $("#detail-btn").html(ja.rtitle_text5);

    $("#register-btn").html(ja.register_btn);
    $("#to-login").html(ja.rto_login);
    $("#gsuccessful_title").html(ja.gsuccessful_title);
    $("#gsuccessfull_text1").html(ja.gsuccessfull_text1);
    $("#gsuccessfull_text2").html(ja.gsuccessfull_text2);
    $("#gactivation_successful_confirm").html(ja.gactivation_successful_confirm);

    $("#gtop_half_title").html(ja.gtop_half_title);//邀请码提示框内容===日文
    $("#gtop_half_text1").html(ja.gtop_half_text1);
    $("#gtop_half_text2").html(ja.gtop_half_text2);
    $("#gtop_half_text3").html(ja.gtop_half_text3);
    $("#gbottom_half_title").html(ja.gbottom_half_title);
    $("#bottom-half-text-ul-p1").html(ja.gbottom_half_text_ul_p1);
    $("#bottom-half-text-ul-p2").html(ja.gbottom_half_text_ul_p2);
}else{
    $("#rtitle_text1").html(cn.rtitle_text1);
    $("#rtitle_text2").html(cn.rtitle_text2);
    $("#rtitle_text3").html(cn.rtitle_text3);

    $("#rtitle_text4").html(cn.rtitle_text4);
    $("#detail-btn").html(cn.rtitle_text5);

    $("#register-btn").html(cn.register_btn);
    $("#to-login").html(cn.rto_login);
    $("#gsuccessful_title").html(cn.gsuccessful_title);
    $("#gsuccessfull_text1").html(cn.gsuccessfull_text1);
    $("#gsuccessfull_text2").html(cn.gsuccessfull_text2);
    $("#gactivation_successful_confirm").html(cn.gactivation_successful_confirm);

    $("#gtop_half_title").html(cn.gtop_half_title);//邀请码提示框内容===中文
    $("#gtop_half_text1").html(cn.gtop_half_text1);
    $("#gtop_half_text2").html(cn.gtop_half_text2);
    $("#gtop_half_text3").html(cn.gtop_half_text3);
    $("#gbottom_half_title").html(cn.gbottom_half_title);
    $("#bottom-half-text-ul-p1").html(cn.gbottom_half_text_ul_p1);
    $("#bottom-half-text-ul-p2").html(cn.gbottom_half_text_ul_p2);
}

$("#register-btn").click(function(){
    if(!account_rule.test($('#account-input').val()))
    {
        if(language=="cn"){
            showTip(cn.inspect);
        }else if(language=="en"){
            showTip(en.inspect);
        }else if(language=="ja"){
            showTip(ja.inspect);
        }else{
            showTip(cn.inspect);
        }
        return
    }
    if(!psw_rule.test($('#password-input').val()))
    {
        if(language=="cn"){
            showTip(cn.inspect);
        }else if(language=="en"){
            showTip(en.inspect);
        }else if(language=="ja"){
            showTip(ja.inspect);
        }else{
            showTip(cn.inspect);
        }
        return
    }
    
    if($("#password-input").val() != $("#confirm-password-input").val())
    {
        if(language=="cn"){
            showTip(cn.inspect);
        }else if(language=="en"){
            showTip(en.inspect);
        }else if(language=="ja"){
            showTip(ja.inspect);
        }else{
            showTip(cn.inspect);
        }
        return
    }
    $.ajax({
        url: url + "/general/register",
        type: "POST",
        data: {
            "account": $("#account-input").val(),
            "password": $("#password-input").val(),
            "code": $("#code-input").val(),
        },
        beforeSend: function(){
            showModalInterface();
        },
        complete: function(){
            hideModalInterface();
        },
        success: function(response){
            if(response.status == 0)
            {
                $.ajax({
                    url: url + "/general/login",
                    type: "POST",
                    data: {
                        "account": $("#account-input").val(),
                        "password": $("#password-input").val(),
                        "code": $.cookie("code"),
                    },
                    beforeSend: function(){
                        showModalInterface();
                    },
                    complete: function(){
                        hideModalInterface();
                    },
                    success: function(response){
                        console.info(response)
                        if(response.status == 0)
                        {
                           $.cookie.json = true
                           $.cookie("user", response.user)
                           $.cookie("promotionId", response.promotionId)
                           $.cookie("exchangerate", response.exchangerate)
                           $(".activation-successful-container").show();
                        }
                        else{
                        //   showTip("账号不存在或者密码错误！")
                            if(language=="cn"){
                                showTip(cn.number_error);
                            }else if(language=="en"){
                                showTip(en.number_error);
                            }else if(language=="ja"){
                                showTip(ja.number_error);
                            }else{
                                showTip(cn.number_error);
                            }
                        }
                    },
                    error: function(error){
                        console.info(error)
                    }
                })
            }else if(response.status == 112){
                // showTip("账户已经存在！")
                if(language=="cn"){
                    showTip(cn.number_exist);
                }else if(language=="en"){
                    showTip(en.number_exist);
                }else if(language=="ja"){
                    showTip(ja.number_exist);
                }else{
                    showTip(cn.number_exist);
                }
            }else if(response.status == 121){
                // showTip("无效的邀请码！")
                if(language=="cn"){
                    showTip(cn.un_code);
                }else if(language=="en"){
                    showTip(en.un_code);
                }else if(language=="ja"){
                    showTip(ja.un_code);
                }else{
                    showTip(cn.un_code);
                }
            }else if(response.status == 122){
                // showTip("邀请码已被使用！")
                if(language=="cn"){
                    showTip(cn.code_used);
                }else if(language=="en"){
                    showTip(en.code_used);
                }else if(language=="ja"){
                    showTip(ja.code_used);
                }else{
                    showTip(cn.code_used);
                }
            }else if(response.status == 123){
                // showTip("邀请码已过期！")
                if(language=="cn"){
                    showTip(cn.expried_code);
                }else if(language=="en"){
                    showTip(en.expried_code);
                }else if(language=="ja"){
                    showTip(ja.expried_code);
                }else{
                    showTip(cn.expried_code);
                }
            }else{
                // showTip("注册失败！")
                if(language=="cn"){
                    showTip(cn.redister_fail);
                }else if(language=="en"){
                    showTip(en.redister_fail);
                }else if(language=="ja"){
                    showTip(ja.redister_fail);
                }else{
                    showTip(cn.redister_fail);
                }
            }
        },
        error: function(error){
            console.info(error)
        }
    })
})

$("#account-input").blur(function(){
    $("#account-input-tip").children().remove();
    $("#account-input-tip").removeClass("error correntness")
    if(account_rule.test($(this).val()))
    {
        $(this).attr("style","");   
    }else{
        $("#account-input-tip").addClass("error");
        // $("#account-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>请输入正确的邮箱地址</p>')
        if(language=="cn"){
            $("#account-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+cn.fill_right_email+'</p>')
        }else if(language=="en"){
            $("#account-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+en.fill_right_email+'</p>')
        }else if(language=="ja"){
            $("#account-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+ja.fill_right_email+'</p>')
        }else{
            $("#account-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+cn.fill_right_email+'</p>')
        }
        $(this).attr("style","border-color:red");
    }
})

$("#password-input").blur(function(){
    $("#password-input-tip").children().remove();
    $("#password-input-tip").removeClass("error correntness");
    if($(this).val() == "")
    {
        $("#password-input").attr("style","");
    }else{
        if(psw_rule.test($(this).val()))
        {
            $("#password-input").attr("style","");
        }else{
            $("#password-input-tip").addClass("error");
            // $("#password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>至少7个以上字符，包含数字和字母，不含空格</p>')
            if(language=="cn"){
                $("#password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+cn.system_req+'</p>')
            }else if(language=="en"){
                $("#password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+en.system_req+'</p>')
            }else if(language=="ja"){
                $("#password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+ja.system_req+'</p>')
            }else{
                $("#password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+cn.system_req+'</p>')
            }
            $("#password-input").attr("style","border-color:red");  
        }
    }

})

$("#confirm-password-input").blur(function(){
    $("#confirm-password-input-tip").children().remove();
    $("#confirm-password-input-tip").removeClass("error correntness");
    if($("#password-input").val() == $(this).val())
    {
        $(this).attr("style","");  
    }else{     
        $(this).attr("style","");
        $("#confirm-password-input-tip").addClass("error");
        // $("#confirm-password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>您必须输入匹配的密码</p>')
        if(language=="cn"){
            $("#confirm-password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+cn.fill_pwd+'</p>')
        }else if(language=="en"){
            $("#confirm-password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+en.fill_pwd+'</p>')
        }else if(language=="ja"){
            $("#confirm-password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+ja.fill_pwd+'</p>')
        }else{
            $("#confirm-password-input-tip").append('<i class="fa fa-times-circle" aria-hidden="true"></i><p>'+cn.fill_pwd+'</p>')
        }
        $(this).attr("style","border-color:red");
    }
})

$("#detail-btn").click(function(){
    $("#code-detail-content").attr("style","display");
});

$(".activation-successful-confirm").click(function(){
    $(".activation-successful-container").hide();
    location.href = "buy.html";
});

$("#detail-close").click(function(){
    $("#code-detail-content").attr("style","display:none;")
});

//===================================================================
})
